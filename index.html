<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>داشبورد گزارش تست سامانه Pivotal</title>
    <!-- بارگذاری Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- بارگذاری Chart.js برای نمودار -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- فونت وزیرمتن -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS سفارشی حداقل شده: فقط برای فونت و تنظیمات Chart.js -->
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f8fafc;
        }
        /* تنظیم ابعاد ثابت برای نمودار دایره‌ای */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 300px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        
        <header class="mb-8 p-4 bg-white rounded-lg shadow-sm border-b-4 border-sky-500">
            <h1 class="text-3xl font-extrabold text-slate-900">گزارش تست سامانه Pivotal</h1>
            <p class="text-slate-500 mt-1">تهیه‌کننده: غزاله رمضانی | تاریخ: ۰۳/۰۷/۱۴۰۴</p>
        </header>

        <main>
            <!-- Section 1: High-Level Summary & Chart -->
            <section id="summary" class="mb-10">
                <h2 class="text-2xl font-semibold mb-4 text-slate-900">خلاصه وضعیت کلی</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="col-span-1 md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-6">
                        <!-- Card: Total Tests -->
                        <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-center items-center transform hover:scale-[1.02] transition duration-300">
                            <span class="text-5xl font-extrabold text-sky-600" id="total-tests">۲۶</span>
                            <span class="text-slate-500 mt-2 text-lg font-medium">کل سناریوها</span>
                        </div>
                        <!-- Card: Passed Tests -->
                        <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-center items-center transform hover:scale-[1.02] transition duration-300">
                            <span class="text-5xl font-extrabold text-green-600" id="passed-tests">۲۱</span>
                            <span class="text-slate-500 mt-2 text-lg font-medium">موفق (Passed)</span>
                        </div>
                        <!-- Card: Failed Tests -->
                        <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-center items-center transform hover:scale-[1.02] transition duration-300">
                            <span class="text-5xl font-extrabold text-red-600" id="failed-tests">۵</span>
                            <span class="text-slate-500 mt-2 text-lg font-medium">ناموفق (Failed)</span>
                        </div>
                    </div>
                    <!-- Chart Card -->
                    <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-center items-center">
                        <div class="chart-container">
                            <canvas id="testStatusChart"></canvas>
                        </div>
                        <p class="text-center text-slate-600 mt-2 font-semibold text-lg">نرخ موفقیت: <span class="text-sky-700" id="pass-rate">۸۰.۸%</span></p>
                    </div>
                </div>
            </section>
            
            <!-- Section 2: Key Findings & Recommendations -->
            <section id="findings" class="mb-10">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h2 class="text-2xl font-semibold mb-4 text-slate-900">مشکلات اصلی شناسایی شده</h2>
                        <div class="space-y-4">
                            <!-- Critical Finding -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-r-8 border-red-700 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-red-800 text-lg">بحرانی: نقص در TeleChat و ارتباط (CORE-001)</h3>
                                <p class="text-slate-600 text-sm mt-1">تماس آنلاین با فیزیوتراپیست با شکست مواجه می‌شود و امکان برقراری ارتباط وجود ندارد.</p>
                            </div>
                            <!-- High Finding -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-r-8 border-red-500 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-red-600 text-lg">بالا: عدم به‌روزرسانی وضعیت تمرین (PLAN-008)</h3>
                                <p class="text-slate-600 text-sm mt-1">وضعیت تمرین پس از اجرا به "Completed" تغییر نمی‌کند و این موضوع بر قابلیت گزارش‌دهی روزانه (Daily Note) تأثیر مستقیم دارد.</p>
                            </div>
                            <!-- High Finding -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-r-8 border-orange-500 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-orange-600 text-lg">بالا: خطای دریافت اطلاعات چت (SUM-005)</h3>
                                <p class="text-slate-600 text-sm mt-1">هنگام دریافت وضعیت TeleChat، خطای `error in fetch_database` رخ می‌دهد.</p>
                            </div>
                            <!-- Medium Finding -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-r-8 border-yellow-500 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-yellow-600 text-lg">متوسط: نقص در اعتبارسنجی فیلد قد (REG-05)</h3>
                                <p class="text-slate-600 text-sm mt-1">سیستم عدد صفر را به عنوان قد معتبر می‌پذیرد که منطقی نیست.</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold mb-4 text-slate-900">پیشنهادها برای بهبود</h2>
                        <div class="space-y-4">
                            <!-- Recommendation -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-l-8 border-sky-600 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-sky-700 text-lg">اولویت بحرانی: رفع مشکلات TeleChat</h3>
                                <p class="text-slate-600 text-sm mt-1">مشکلات برقراری تماس آنلاین و خطای `fetch_database` باید فوراً رفع شوند تا ارتباط بیمار و فیزیوتراپیست مختل نشود.</p>
                            </div>
                            <!-- Recommendation -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-l-8 border-sky-500 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-sky-600 text-lg">اولویت بالا: اصلاح منطق وضعیت تمرین</h3>
                                <p class="text-slate-600 text-sm mt-1">اطمینان حاصل شود که وضعیت تمرین پس از اتمام به "Completed" تغییر کرده و امکان ثبت Daily Note فراهم شود.</p>
                            </div>
                            <!-- Recommendation -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-l-8 border-cyan-500 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-cyan-600 text-lg">اولویت متوسط: تقویت اعتبارسنجی فیلد قد</h3>
                                <p class="text-slate-600 text-sm mt-1">محدوده منطقی برای فیلد قد تعریف شود تا از پذیرش مقادیری مانند "صفر" جلوگیری شود.</p>
                            </div>
                            <!-- Recommendation -->
                            <div class="bg-white p-4 rounded-xl shadow-lg border-l-8 border-teal-500 hover:shadow-xl transition duration-300">
                                <h3 class="font-bold text-teal-600 text-lg">اولویت پایین: استانداردسازی پیام‌های خطا</h3>
                                <p class="text-slate-600 text-sm mt-1">متن خطای مربوط به ایمیل تکراری (REG-08) استانداردسازی شود تا پیام واضح و کاربرپسندی نمایش داده شود.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 3: Detailed Test Results Table -->
            <section id="details">
                <h2 class="text-2xl font-semibold mb-4 text-slate-900">نتایج تفصیلی تست</h2>
                <div class="bg-white p-4 sm:p-6 rounded-xl shadow-lg">
                    <div class="flex flex-col xl:flex-row justify-between items-start xl:items-center mb-4 gap-4">
                        <!-- Module Tabs -->
                        <div id="tabs" class="flex flex-wrap gap-2">
                            <button data-module="all" class="tab-btn px-4 py-2 text-sm rounded-lg font-semibold bg-sky-600 text-white hover:bg-sky-500 transition-colors">همه ماژول‌ها</button>
                            <button data-module="registration" class="tab-btn px-4 py-2 text-sm rounded-lg font-semibold bg-slate-200 text-slate-700 hover:bg-sky-500 hover:text-white transition-colors">صفحه ثبت‌نام</button>
                            <button data-module="exercise" class="tab-btn px-4 py-2 text-sm rounded-lg font-semibold bg-slate-200 text-slate-700 hover:bg-sky-500 hover:text-white transition-colors">صفحه ورزش کاربر</button>
                            <button data-module="summary" class="tab-btn px-4 py-2 text-sm rounded-lg font-semibold bg-slate-200 text-slate-700 hover:bg-sky-500 hover:text-white transition-colors">خلاصه وضعیت و ارزیابی</button>
                        </div>
                        <!-- Status Filters -->
                        <div id="filters" class="flex flex-wrap gap-2 pt-2 xl:pt-0">
                            <button data-status="all" class="filter-btn px-3 py-1.5 text-xs rounded-lg font-semibold bg-cyan-700 text-white hover:bg-cyan-600 transition-colors">همه</button>
                            <button data-status="Passed" class="filter-btn px-3 py-1.5 text-xs rounded-lg font-semibold bg-slate-200 text-slate-600 hover:bg-cyan-600 hover:text-white transition-colors">موفق</button>
                            <button data-status="Failed" class="filter-btn px-3 py-1.5 text-xs rounded-lg font-semibold bg-slate-200 text-slate-600 hover:bg-cyan-600 hover:text-white transition-colors">ناموفق</button>
                        </div>
                    </div>

                    <div class="overflow-x-auto rounded-lg border border-slate-200">
                        <table class="w-full text-sm text-right">
                            <thead class="bg-slate-100 border-b border-slate-200">
                                <tr>
                                    <th class="p-3 font-bold tracking-wide text-slate-700 w-24">ID تست</th>
                                    <th class="p-3 font-bold tracking-wide text-slate-700">شرح سناریو</th>
                                    <th class="p-3 font-bold tracking-wide text-slate-700 min-w-[250px]">نتیجه واقعی</th>
                                    <th class="p-3 font-bold tracking-wide text-slate-700 text-center w-28">وضعیت</th>
                                </tr>
                            </thead>
                            <tbody id="results-table" class="divide-y divide-slate-100">
                                <!-- Rows will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="text-center mt-10 p-4 text-slate-500 text-xs">
            <p>داشبورد گزارش تست خودکار | ایجاد شده برای پروژه Pivotal</p>
        </footer>

    </div>

    <script>
        // داده‌های تست (بدون تغییر)
        const testData = [
            { id: 'REG-01', module: 'registration', description: 'ثبت‌نام با فیلدهای اجباری خالی.', actual: 'کاربر نمی‌تواند ثبت‌نام کند (پیام خطا نمایش داده شد).', status: 'Passed' },
            { id: 'REG-02', module: 'registration', description: 'ورود نام و نام خانوادگی نامعتبر (اعداد/کاراکترهای خاص).', actual: 'به کاربر خطا نشان داده می‌شود.', status: 'Passed' },
            { id: 'REG-03', module: 'registration', description: 'وارد کردن تاریخ تولد در آینده.', actual: 'کاربر نمی‌تواند تاریخ تولدی در آینده را انتخاب کند.', status: 'Passed' },
            { id: 'REG-05', module: 'registration', description: 'قد غیرمنطقی (صفر، منفی یا عدد خیلی بالا).', actual: 'سامانه عدد منفی را قبول نمی‌کند ولی عدد ۰ مورد قبول است.', status: 'Failed' },
            { id: 'REG-06', module: 'registration', description: 'ورود حروف یا کاراکترهای خاص در فیلد قد.', actual: 'کاربر نمی‌تواند کارکترهای حروف را وارد کند.', status: 'Passed' },
            { id: 'REG-07', module: 'registration', description: 'انتخاب ناقص پلن و کلینیک (فقط یکی انتخاب شود).', actual: 'به کاربر خطا نشان داده می‌شود.', status: 'Passed' },
            { id: 'REG-08', module: 'registration', description: 'وارد کردن ایمیل تکراری (قبلاً ثبت شده).', actual: 'به کاربر خطا نشان داده می‌شود اما متن خطا استاندارد نیست.', status: 'Failed' },
            { id: 'REG-09', module: 'registration', description: 'ایمیل با فرمت نامعتبر (بدون "@" یا ".com").', actual: 'به کاربر خطا نشان داده می‌شود.', status: 'Passed' },
            { id: 'REG-10', module: 'registration', description: 'وارد کردن نام کاربری کمتر از ۳ کاراکتر.', actual: 'به کاربر خطا نشان داده می‌شود.', status: 'Passed' },
            { id: 'REG-13', module: 'registration', description: 'عدم تطابق رمز عبور و تأیید رمز.', actual: 'به کاربر خطا نشان داده می‌شود.', status: 'Passed' },
            { id: 'REG-14', module: 'registration', description: 'ثبت‌نام موفق با داده‌های معتبر.', actual: 'ثبت‌نام موفق انجام شده و داده‌ها در پایگاه داده ثبت شده‌اند.', status: 'Passed' },
            { id: 'REG-19', module: 'registration', description: 'قابلیت نمایش رمز عبور (Password Visibility).', actual: 'عملکرد درست است.', status: 'Passed' },
            { id: 'PLAN-001', module: 'exercise', description: 'تغییر بین Today Class و Today Exercise.', actual: 'محتوای جدول متناسب با انتخاب کاربر به‌روزرسانی شود.', status: 'Passed' },
            { id: 'PLAN-004', module: 'exercise', description: 'نمایش تمرینات روز جاری (مثلاً جمعه).', actual: 'فقط تمریناتی که در Pick Days شامل روز جاری هستند، نمایش داده شوند.', status: 'Passed' },
            { id: 'PLAN-005', module: 'exercise', description: 'بررسی تاریخ‌های Start و End تمرین‌ها.', actual: 'تاریخ‌ها باید با برنامه درمانی کاربر منطبق باشند.', status: 'Passed' },
            { id: 'PLAN-006', module: 'exercise', description: 'اجرای تمرین از طریق دکمه Join.', actual: 'کاربر به صفحه اجرای تمرین می‌رود.', status: 'Passed' },
            { id: 'PLAN-007', module: 'exercise', description: 'بررسی وضعیت Active تمرین در حال اجرا.', actual: 'وضعیت Active برای آن تمرین به‌درستی نمایش داده شود.', status: 'Passed' },
            { id: 'PLAN-008', module: 'exercise', description: 'تغییر وضعیت تمرین به Completed پس از اجرا.', actual: 'در تست، وضعیت تغییر نکرد و کاربر دوباره می‌توانست تمرین را انجام دهد.', status: 'Failed' },
            { id: 'PLAN-009', module: 'exercise', description: 'باز شدن Daily Note (وابسته به تکمیل تمرینات).', actual: 'به علت مشکل شماره ۸ (PLAN-008) کاربر نمی‌تواند دیلی نوت را بگیرد.', status: 'Failed' },
            { id: 'SUM-001', module: 'summary', description: 'نمایش تعداد تمرین‌ها در کارت Exercise.', actual: 'عملکرد درست است.', status: 'Passed' },
            { id: 'SUM-002', module: 'summary', description: 'هدایت از دکمه Show به صفحه جزئیات.', actual: 'عملکرد درست است.', status: 'Passed' },
            { id: 'SUM-005', module: 'summary', description: 'نمایش عدم وجود TeleChat برای کاربر بدون چت فعال.', actual: 'ارور `error in fetch_database` نمایش داده می‌شود.', status: 'Failed' },
            { id: 'SUM-007', module: 'summary', description: 'هدایت از لینک See All در کارت Document.', actual: 'عملکرد درست است.', status: 'Passed' },
            { id: 'SUM-008', module: 'summary', description: 'هدایت از لینک Details در کارت کوچک Exercise.', actual: 'عملکرد درست است.', status: 'Passed' },
            { id: 'EVAL-002', module: 'summary', description: 'مشاهده همه ارزیابی‌ها از دکمه View all.', actual: 'عملکرد درست است.', status: 'Passed' },
            { id: 'EVAL-008', module: 'summary', description: 'Reply برای نوبت آنلاین آینده.', actual: 'عملکرد درست است.', status: 'Passed' },
        ];

        let currentModule = 'all';
        let currentStatus = 'all';

        document.addEventListener('DOMContentLoaded', () => {
            const passedCount = testData.filter(t => t.status === 'Passed').length;
            const failedCount = testData.filter(t => t.status === 'Failed').length;
            const totalCount = testData.length;
            
            // به‌روزرسانی کارت‌های خلاصه
            document.getElementById('total-tests').textContent = totalCount;
            document.getElementById('passed-tests').textContent = passedCount;
            document.getElementById('failed-tests').textContent = failedCount;
            document.getElementById('pass-rate').textContent = ((passedCount / totalCount) * 100).toFixed(1) + '%';

            renderChart(passedCount, failedCount);
            renderTable();

            // مدیریت جابجایی تب‌ها (ماژول‌ها)
            document.getElementById('tabs').addEventListener('click', (e) => {
                if (e.target.classList.contains('tab-btn')) {
                    const activeClasses = ['bg-sky-600', 'text-white'];
                    const inactiveClasses = ['bg-slate-200', 'text-slate-700'];

                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove(...activeClasses);
                        btn.classList.add(...inactiveClasses);
                    });
                    
                    e.target.classList.add(...activeClasses);
                    e.target.classList.remove(...inactiveClasses);
                    
                    currentModule = e.target.dataset.module;
                    renderTable();
                }
            });

            // مدیریت فیلترهای وضعیت
            document.getElementById('filters').addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    // استفاده از bg-cyan-700 برای مطابقت با رنگ قبلی filter-active
                    const activeClasses = ['bg-cyan-700', 'text-white'];
                    const inactiveClasses = ['bg-slate-200', 'text-slate-600'];

                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove(...activeClasses);
                        btn.classList.add(...inactiveClasses);
                    });
                    
                    e.target.classList.add(...activeClasses);
                    e.target.classList.remove(...inactiveClasses);
                    
                    currentStatus = e.target.dataset.status;
                    renderTable();
                }
            });
        });

        // رندر نمودار Chart.js
        function renderChart(passed, failed) {
            const ctx = document.getElementById('testStatusChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['موفق', 'ناموفق'],
                    datasets: [{
                        data: [passed, failed],
                        backgroundColor: ['#22c55e', '#ef4444'], // green-500, red-500
                        borderColor: ['#f8fafc'], // bg-slate-50
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 20,
                                font: {
                                    family: "'Vazirmatn', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            bodyFont: {
                                family: "'Vazirmatn', sans-serif"
                            },
                            titleFont: {
                                family: "'Vazirmatn', sans-serif"
                            }
                        }
                    }
                }
            });
        }
        
        // رندر جدول نتایج بر اساس فیلترها و تب‌ها
        function renderTable() {
            const tableBody = document.getElementById('results-table');
            tableBody.innerHTML = '';

            const filteredData = testData.filter(item => {
                const moduleMatch = currentModule === 'all' || item.module === currentModule;
                const statusMatch = currentStatus === 'all' || item.status === currentStatus;
                return moduleMatch && statusMatch;
            });

            if (filteredData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="4" class="text-center p-4 text-slate-500">هیچ موردی برای نمایش یافت نشد.</td></tr>`;
                return;
            }

            filteredData.forEach(item => {
                // تعیین کلاس‌های Tailwind بر اساس وضعیت
                const statusClass = item.status === 'Passed' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700';
                const statusIcon = item.status === 'Passed' ? '✓' : '✗';
                
                const row = `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-3 text-slate-700 font-bold">${item.id}</td>
                        <td class="p-3 text-slate-700">${item.description}</td>
                        <td class="p-3 text-slate-600">${item.actual}</td>
                        <td class="p-3 text-center">
                            <span class="px-3 py-1 text-xs font-semibold rounded-full ${statusClass} shadow-sm">
                                ${statusIcon} ${item.status === 'Passed' ? 'موفق' : 'ناموفق'}
                            </span>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }
    </script>
</body>
</html>

